<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Eight Absensi Harian Kelas 9E</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(to bottom, #cce5ff, #e6f2ff);
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      transition: background 1s ease-in-out;
    }

    .container {
      background: white;
      padding: 25px 30px;
      border-radius: 20px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.1);
      text-align: center;
      width: 90%;
      max-width: 420px;
      animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h1 { color: #0077cc; margin-bottom: 8px; }
    h2 { color: #333; font-size: 16px; margin-bottom: 10px; }

    select, input, textarea {
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      border: 1px solid #ccc;
      border-radius: 10px;
      font-size: 14px;
    }

    button {
      width: 100%;
      padding: 12px;
      background-color: #4da6ff;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 15px;
      margin-top: 8px;
      transition: background 0.3s ease;
    }

    button:hover { background-color: #3399ff; }
    .hidden { display: none; }

    .absensi-list {
      text-align: left;
      margin-top: 20px;
      background: #f8fbff;
      border-radius: 12px;
      padding: 15px;
      border: 1px solid #cce0ff;
      max-height: 300px;
      overflow-y: auto;
    }

    .absensi-item {
      margin-bottom: 10px;
      border-bottom: 1px dashed #aaccee;
      padding-bottom: 5px;
    }

    .data-header {
      font-weight: bold;
      color: #0066cc;
      margin-bottom: 10px;
    }

    .back-button { margin-top: 15px; background-color: #ff6666; }
    .back-button:hover { background-color: #ff4d4d; }

    .delete-button { background-color: #ff944d; margin-top: 5px; }
    .delete-button:hover { background-color: #ff751a; }

    #realTimeClock { color: #555; font-weight: bold; margin-bottom: 15px; }

    /* === Tambahan untuk ikon mata di kolom password === */
    .password-wrapper {
      position: relative;
      width: 100%;
    }
    .password-wrapper input {
      width: 100%;
      padding-right: 40px;
      box-sizing: border-box;
    }
    .password-wrapper .toggle-eye {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      color: gray;
      font-size: 18px;
      user-select: none;
      transition: 0.3s;
    }
    .password-wrapper .toggle-eye:hover {
      color: black;
    }

    audio { display: none; }
  </style>
</head>
<body>
  <audio id="bgMusic" autoplay loop>
    <source src="https://cdn.pixabay.com/download/audio/2023/03/01/audio_ef7b4f4e7e.mp3?filename=relaxing-guitar-music-140795.mp3" type="audio/mpeg">
  </audio>

  <!-- Halaman Login -->
  <div class="container" id="loginPage">
    <h1 id="greeting">Selamat Datang!</h1>
    <h2>Eight Absensi Harian Kelas 9E</h2>
    <p id="realTimeClock"></p>

    <label>Pilih Peran:</label>
    <select id="role">
      <option value="siswa">Siswa</option>
      <option value="guru">Guru</option>
    </select>

    <!-- === Kolom password dengan ikon mata === -->
    <div class="password-wrapper">
      <input type="password" id="password" placeholder="Masukkan Password">
      <span class="toggle-eye" onclick="togglePassword()">ğŸ‘ï¸</span>
    </div>

    <button onclick="login()">Masuk</button>
  </div>

  <!-- Halaman Siswa -->
  <div class="container hidden" id="siswaPage">
    <h1>Absensi Siswa</h1>

    <label>Nama Siswa</label>
    <input type="text" id="namaSiswa" placeholder="Masukkan nama lengkap">

    <label>Nomor Absen</label>
    <select id="noAbsen"></select>

    <label>Status Kehadiran</label>
    <select id="status">
      <option value="Hadir">Hadir</option>
      <option value="Sakit">Sakit</option>
      <option value="Alpha">Alpha</option>
    </select>

    <label>Alasan (opsional)</label>
    <textarea id="alasan" placeholder="Tulis alasan jika tidak hadir..."></textarea>

    <button onclick="kirimAbsensi()">Kirim Absensi</button>
    <button class="back-button" onclick="logout()">ğŸšª Logout</button>
  </div>

  <!-- Halaman Guru -->
  <div class="container hidden" id="guruPage">
    <h1>Daftar Absensi Hari Ini</h1>
    <input type="date" id="filterTanggal" onchange="tampilkanAbsensi()">
    <div class="data-header" id="dataInfo"></div>
    <div class="absensi-list" id="absensiList"></div>
    <textarea id="catatanGuru" placeholder="Catatan tambahan (opsional)..."></textarea>
    <button onclick="copyAbsensi()">ğŸ“‹ Salin Semua</button>
    <button onclick="exportAbsensi()">ğŸ’¾ Ekspor ke File</button>
    <button onclick="cetakPDF()">ğŸ–¨ï¸ Cetak PDF</button>
    <button class="delete-button" onclick="hapusData()">ğŸ—‘ï¸ Hapus Semua</button>
    <button class="back-button" onclick="logout()">ğŸšª Logout</button>
  </div>

  <script>
    // ğŸ‘ï¸ Fungsi untuk menampilkan/menyembunyikan password
    function togglePassword() {
      const passwordField = document.getElementById("password");
      const eyeIcon = document.querySelector(".toggle-eye");
      if (passwordField.type === "password") {
        passwordField.type = "text";
        eyeIcon.textContent = "ğŸ™ˆ";
      } else {
        passwordField.type = "password";
        eyeIcon.textContent = "ğŸ‘ï¸";
      }
    }

    // ğŸ”Š Fungsi mainkan suara notifikasi
    function playSound(url) {
      const sound = new Audio(url);
      sound.play();
    }

    // ğŸ”„ Jam real-time
    setInterval(() => {
      const now = new Date();
      document.getElementById("realTimeClock").innerText =
        now.toLocaleString("id-ID", { 
          weekday: "long", year: "numeric", month: "long", 
          day: "numeric", hour: "2-digit", minute: "2-digit", second: "2-digit" 
        });
    }, 1000);

    // ğŸ§® Data absensi
    let absensiData = [];
    const noAbsenSelect = document.getElementById("noAbsen");
    for (let i = 1; i <= 30; i++) {
      const opt = document.createElement("option");
      opt.value = i;
      opt.textContent = i;
      noAbsenSelect.appendChild(opt);
    }

    // ğŸŒ„ Tema otomatis
    function updateTheme() {
      const hour = new Date().getHours();
      const body = document.body;
      if (hour >= 5 && hour < 11)
        body.style.background = "linear-gradient(to bottom, #a8d8ff, #e6f7ff)";
      else if (hour >= 11 && hour < 17)
        body.style.background = "linear-gradient(to bottom, #ffe6a8, #fff5cc)";
      else
        body.style.background = "linear-gradient(to bottom, #001f3f, #334d80)";
    }
    updateTheme();

    function login() {
      const role = document.getElementById('role').value;
      const password = document.getElementById('password').value;

      if (role === 'guru' && password === 'BuEkoGuru9E') {
        showPage('guru');
        tampilkanAbsensi();
        playSound("https://cdn.pixabay.com/download/audio/2022/03/15/audio_4bce2331a1.mp3?filename=success-1-6297.mp3");
      } else if (role === 'siswa' && password === 'SiswaKelas9E') {
        showPage('siswa');
        playSound("https://cdn.pixabay.com/download/audio/2022/03/15/audio_4bce2331a1.mp3?filename=success-1-6297.mp3");
      } else {
        alert('âš ï¸ Password salah!');
      }
    }

    function showPage(role) {
      document.querySelectorAll('.container').forEach(c => c.classList.add('hidden'));
      document.getElementById(role + 'Page').classList.remove('hidden');
    }

    function logout() {
      showPage('login');
      document.getElementById('password').value = '';
    }

    function kirimAbsensi() {
      const namaSiswa = document.getElementById('namaSiswa').value.trim();
      const noAbsen = document.getElementById('noAbsen').value;
      const status = document.getElementById('status').value;
      const alasan = document.getElementById('alasan').value || '-';
      const waktu = new Date();
      const jam = waktu.toLocaleTimeString();
      const tanggal = waktu.toLocaleDateString('id-ID', { day: '2-digit', month: 'long', year: 'numeric' });
      const key = `absensi_${tanggal}`;
      absensiData = JSON.parse(localStorage.getItem(key)) || [];

      if (!namaSiswa) return alert('âš ï¸ Harap isi nama!');
      const sudahAbsen = absensiData.some(a => a.noAbsen === noAbsen);
      if (sudahAbsen) return alert('âš ï¸ Kamu sudah absen hari ini!');

      absensiData.push({ namaSiswa, noAbsen, status, alasan, jam, tanggal });
      localStorage.setItem(key, JSON.stringify(absensiData));
      playSound("https://cdn.pixabay.com/download/audio/2022/03/15/audio_4bce2331a1.mp3?filename=success-1-6297.mp3");
      alert("âœ… Absensi berhasil dikirim!");
      logout();
    }

    function tampilkanAbsensi() {
      const filterTanggal = document.getElementById("filterTanggal").value;
      const tanggal = filterTanggal
        ? new Date(filterTanggal).toLocaleDateString('id-ID', { day: '2-digit', month: 'long', year: 'numeric' })
        : new Date().toLocaleDateString('id-ID', { day: '2-digit', month: 'long', year: 'numeric' });
      const key = `absensi_${tanggal}`;
      absensiData = JSON.parse(localStorage.getItem(key)) || [];

      const list = document.getElementById('absensiList');
      const dataInfo = document.getElementById('dataInfo');
      list.innerHTML = '';

      const total = absensiData.length;
      const hadir = absensiData.filter(a => a.status === "Hadir").length;
      const sakit = absensiData.filter(a => a.status === "Sakit").length;
      const alpha = absensiData.filter(a => a.status === "Alpha").length;

      dataInfo.innerHTML = `Data Siswa 9E â€” ${tanggal}<br>ğŸ§® Total: ${total} | âœ… Hadir: ${hadir} | ğŸ¤’ Sakit: ${sakit} | âŒ Alpha: ${alpha}`;

      if (!total) return list.innerHTML = '<i>Belum ada absensi hari ini</i>';

      absensiData.forEach((item, i) => {
        list.innerHTML += `
          <div class="absensi-item">
            ğŸ‘¤ <b>${item.namaSiswa}</b> (No ${item.noAbsen})<br>
            ğŸ“… ${item.tanggal} | ğŸ•’ ${item.jam}<br>
            âœ… ${item.status}<br>
            ğŸ’¬ ${item.alasan}
            <button style="margin-top:5px;" onclick="salinSatu(${i})">ğŸ“‹ Salin</button>
          </div>`;
      });
    }

    function salinSatu(i) {
      const a = absensiData[i];
      navigator.clipboard.writeText(`${a.namaSiswa} (No ${a.noAbsen}) | ${a.status} | ${a.alasan} | ${a.tanggal} ${a.jam}`);
      alert("âœ… Data siswa disalin!");
    }

    function copyAbsensi() {
      const text = absensiData.map(a => `${a.namaSiswa} (No ${a.noAbsen}) | ${a.status} | ${a.alasan}`).join('\n');
      navigator.clipboard.writeText(text);
      alert("ğŸ“‹ Semua data disalin!");
    }

    function exportAbsensi() {
      const text = absensiData.map(a => `${a.namaSiswa} (No ${a.noAbsen}) | ${a.status} | ${a.alasan}`).join('\n');
      const blob = new Blob([text], { type: "text/plain" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "data_absensi_9E.txt";
      a.click();
      URL.revokeObjectURL(url);
    }

    function cetakPDF() {
      const printWindow = window.open('', '', 'width=800,height=600');
      printWindow.document.write('<html><head><title>Laporan Absensi 9E</title></head><body>');
      printWindow.document.write('<h2>Rekap Absensi Kelas 9E</h2>');
      printWindow.document.write('<pre>' + absensiData.map(a =>
        `${a.namaSiswa} (No ${a.noAbsen}) | ${a.status} | ${a.alasan} | ${a.tanggal} ${a.jam}`
      ).join('\n') + '</pre>');
      printWindow.document.write('</body></html>');
      printWindow.document.close();
      printWindow.print();
    }

    function hapusData() {
      if (confirm("Yakin ingin menghapus semua data absensi?")) {
        const tanggal = new Date().toLocaleDateString('id-ID', { day: '2-digit', month: 'long', year: 'numeric' });
        localStorage.removeItem(`absensi_${tanggal}`);
        absensiData = [];
        tampilkanAbsensi();
        alert("ğŸ—‘ï¸ Semua data absensi dihapus.");
      }
    }
  </script>
</body>
  </html>
